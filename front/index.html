<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Project Geysir</title>
	<script type="text/javascript" src="/scripts/vis.js"></script>
	<link href="/scripts/vis.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/stylesheet.css" type="text/css" media="screen">
	<link rel="stylesheet" href="css/loading.css" type="text/css" media="screen">
</head>
<body id="index" onload="">
	<div id ="header">
		<center><img src="geysir.png" alt="some_text" style="width:128px;height:128px;"></center>
		<h1><center>Geysir</center></h1>
	</div>
	<div id="main">
		<div id="blackbox">	
			<label for="inputUser">Enter your Account ID</label>
			<br>
				<input id="inputUser"  autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" type="text" onkeypress="handle(event)" value="76561198073068355"/>
			<br>
			<button class="btn btn-success" id="hit">Send</button>
			<div id="status">alles ok</div>
			<form name="drop_list">	
				<select id="gamesDrop">
					<option>Choose a game!</option>
				</select>
			</form>
			<div id="friends"></div>
			<div id = "network">
				<div id = "loading">
					<div class="cssload-dots">
						<div class="cssload-dot"></div>
						<div class="cssload-dot"></div>
						<div class="cssload-dot"></div>
						<div class="cssload-dot"></div>
						<div class="cssload-dot"></div>
					</div>

					<svg version="1.1" xmlns="http://www.w3.org/2000/svg">
						<defs>
							<filter id="goo">
								<feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="12" ></feGaussianBlur>
								<feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0	0 1 0 0 0	0 0 1 0 0	0 0 0 18 -7" result="goo" ></feColorMatrix>
								<!--<feBlend in2="goo" in="SourceGraphic" result="mix" ></feBlend>-->
							</filter>
						</defs>
					</svg>
				</div>
			</div>
		</div>
	</div>
	<div id="footer">
		<!--TO BE DEFINED-->
	</div>
	
</body>
</html>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
	var socket = io();
	var username = '';
	
	socket.on('friends', function (response) {
		if(response.type = 'friends'){
			$('#friends').empty()
			var friends_list = response.friends;
			var friends = '';
			var nodes = new vis.DataSet([
				{id: 1, label: "You"}
			]);
			var edges = new vis.DataSet();
			for (var i = 0; i < friends_list.length; i++){
				console.log(friends_list[i]);
				friends += friends_list[i] + "<br>";
				nodes.add({id: i+2, label: friends_list[i]})
				edges.add({from: 1, to: i+2});
			}
			var container = document.getElementById('network');
			var data = {
				nodes: nodes,
				edges: edges
			};
			var options = {};
			$('#loading').hide();
			var network = new vis.Network(container, data, options);
			/*$('#friends').html(friends);*/
		}
		if (response.type == 'error'){
			$('#status').text(response.state);
			$('#gamesDrop').empty();
			$('#gamesDrop').hide();
			username = '';
		}
	});
	
	
	
	
	socket.on('games', function (response) {
		if (response.type == 'games'){
			var games = response.games;
			var option = '';
			$('#gamesDrop').empty();
			for ( var i = 0; i < games.length; i++){
				option += '<option value="'+ games[i].appid + '">' + games[i].name + '</option>';
			}
			$('#gamesDrop').append(option);
			$('#status').text('Choose a game:');
			$('#gamesDrop').show();
		}
		if (response.type == 'error'){
			$('#status').text(response.state);
			$('#gamesDrop').empty();
			$('#gamesDrop').hide();
			username = '';
		}
	});
	
	
	
	
	
	$('#hit').click(function () {
		sendIdRequest()
	});
	
	function handle(e){
		if(e.keyCode === 13){
			sendIdRequest()
		}
		return false;
	}
	
	
	
	
	function sendIdRequest(){
		name = String($('#inputUser').val());
		var patt = /^[0-9]+$/
		
		if (patt.test(name) && name != username){
			username = name;
			socket.emit('user', {
				username: name,
			});
		}
		else if(name == username){
			$('#status').text('same ID');
		}
		else{
			$('#status').text('An ID only consists of numbers');
			$('#gamesDrop').empty();
			$('#gamesDrop').hide();
			username = '';
		}
    }
	
	
	
	
	$('#gamesDrop').change(function () {
		var selectedValue = parseInt(jQuery(this).val());
		$('#status').text(selectedValue);
		$('#loading').show();
		socket.emit('game', {
			username: username,
			game: selectedValue
		});
	});
	

</script>

	