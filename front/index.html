<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Project Geysir</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/stylesheet.css" type="text/css" media="screen">
</head>
<body id="index" onload="">
	<div id ="header">
		<center><img src="geysir.png" alt="some_text" style="width:128px;height:128px;"></center>
		<h1><center>Geysir</center></h1>
	</div>
	<div id="main">
		<div id="blackbox">	
			<label for="inputUser">Enter your Account ID</label>
			<br>
				<input id="inputUser"  autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" type="text" onkeypress="handle(event)" value="76561198073068355"/>
			<br>
			<button class="btn btn-success" id="hit">Send</button>
			<div id="status">alles ok</div>
			<form name="drop_list">	
				<select id="gamesDrop">
					<option>Choose a game!</option>
				</select>
			</form>
			<div id="friends"><div>
		</div>
	</div>
	<div id="footer">
		<!--TO BE DEFINED-->
	</div>
	
</body>
</html>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
	var socket = io();
	var username = '';
	
	socket.on('friends', function (response) {
		if(response.type = 'friends'){
			$('#friends').empty()
			var friends_list = response.friends;
			var friends = '';
			for (var i = 0; i < friends_list.length; i++){
				console.log(friends_list[i]);
				friends += friends_list[i] + "<br>";
			}
			$('#friends').html(friends);
		}
		if (response.type == 'error'){
			$('#status').text(response.state);
			$('#gamesDrop').empty();
			$('#gamesDrop').hide();
			username = '';
		}
	});
	
	socket.on('games', function (response) {
		if (response.type == 'games'){
			var games = response.games;
			var option = '';
			$('#gamesDrop').empty();
			for ( var i = 0; i < games.length; i++){
				option += '<option value="'+ games[i].appid + '">' + games[i].name + '</option>';
			}
			$('#gamesDrop').append(option);
			$('#status').text('Choose a game:');
			$('#gamesDrop').show();
		}
		if (response.type == 'error'){
			$('#status').text(response.state);
			$('#gamesDrop').empty();
			$('#gamesDrop').hide();
			username = '';
		}
	});
	
	$('#hit').click(function () {
		sendIdRequest()
	});
	
	function handle(e){
		if(e.keyCode === 13){
			sendIdRequest()
		}
		return false;
	}
	
	function sendIdRequest(){
		name = String($('#inputUser').val());
		var patt = /^[0-9]+$/
		
		if (patt.test(name) && name != username){
			username = name;
			socket.emit('user', {
				username: name,
			});
		}
		else if(name == username){
			$('#status').text('same ID');
		}
		else{
			$('#status').text('An ID only consists of numbers');
			$('#gamesDrop').empty();
			$('#gamesDrop').hide();
			username = '';
		}
    }
	
	$('#gamesDrop').change(function () {
		var selectedValue = parseInt(jQuery(this).val());
		$('#status').text(selectedValue);
		socket.emit('game', {
			username: username,
			game: selectedValue
		});
	});
	

</script>

	